<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8" />
	<title>translation-generator</title>
	<script src="https://code.jquery.com/jquery-1.11.1.min.js"></script>
	<script src="https://code.jquery.com/jquery-migrate-1.2.1.min.js"></script>
	<!-- BEGIN EDIT these elements for fancyBox -->
	<link rel="stylesheet" href="local/fancybox/source/jquery.fancybox.css?v=2.1.3" type="text/css" media="screen" />
	<script type="text/javascript" src="local/fancybox/source/jquery.fancybox.pack.js?v=2.1.3"></script>
	<!-- END EDIT -->
	<link rel="stylesheet" type="text/css" href="translation-viewer.css" />
	<link rel="stylesheet" type="text/css" href="poetry.css" />
    <style type="text/css">
fieldset.stanza, fieldset.title {
    overflow: auto;
    white-space: nowrap;
}

fieldset.stanza div.edition, form fieldset.title div.edition {
    display: inline-block;
    margin-right: 5px;
    margin-left: 5px;
}

fieldset.stanza div.edition label, form fieldset.title div.edition label {
    display: block;
    width: 300px;
}

fieldset.stanza div.edition textarea{
    height: 250px;
    width: 100%;
}
    </style>
	<script type="text/javascript" src="translation-viewer.js"></script>
	<script type="text/javascript">
		$(document).ready(function() {
            $('form#viewer').hide();
            $('form#viewer fieldset#code').hide();
            $('form#viewer input#show_preview').hide();

            $('form#editor input#add_stanza').click(function () {
                var stanza_fs = $('form#editor fieldset.stanza').last().clone();
                var stanza_no = Number(stanza_fs.attr('stanza')) + 1;

                var stanza_no_span = stanza_fs.find('legend span');
                stanza_no_span.html(stanza_no);
                stanza_fs.attr('stanza', stanza_no);

                stanza_fs.appendTo('form#editor')
            });

            $('form#editor input#add_trans').click(function () {
                $('form#editor fieldset.stanza').map(function () {
                    var stanza_no = Number($(this).attr('stanza'));

                    var trans = $(this).find('div').last().clone();
                    var trans_no = Number(trans.attr('edition')) + 1;
                    trans.attr('edition', trans_no);
                    trans.appendTo(this);

                    var stanza_trans = String(stanza_no) + '-' + String(trans_no);

                    var label = trans.find('label');
                    label.attr('for', stanza_trans);
                    label.html('Translation ' + trans_no);

                    var ta = trans.find('textarea');
                    ta.attr('id', stanza_trans);
                });

                // Deduplicate v. $('input.#add_trans').click() above.
                $('form#editor fieldset.title').map(function () {
                    var stanza_no = Number($(this).attr('stanza'));

                    var trans = $(this).find('div').last().clone();
                    var trans_no = Number(trans.attr('edition')) + 1;
                    trans.attr('edition', trans_no);
                    trans.appendTo(this);

                    var stanza_trans = String(stanza_no) + '-' + String(trans_no);

                    var label = trans.find('label');
                    label.attr('for', stanza_trans);
                    label.html('Translation ' + trans_no);
                });
            });

            $('input#render').click(function () {
                $('form#editor').hide();

                var texts = $('<dl></dl')
                    .addClass('translation-viewer-texts');
                $('fieldset#output').html(texts);

                $('form#editor fieldset.title div.edition').each(function () {
                    var edition = $(this).attr('edition');
                    var title = $('<dt></dt>')
                        .html($(this).find('input').val())
                        .appendTo(texts);
                    title.after(
                        $('form#editor fieldset.stanza div.edition[edition=' + edition + ']')
                            .map(function () {
                                return $('<dd></dd>')
                                    .append($('<ol></ol>')
                                        .addClass('vrs')
                                        .append(
                                            $(this).find('textarea').val().split('\n')
                                                .map(function (s) {
                                                    return $('<li></li>')
                                                        .html(s);
                                                })
                                            )
                                        )
                                }).get()
                    );
                });

//              $('dl.translation-viewer-texts').translation_viewer();
//              $('.fancybox').fancybox();

                $('form#viewer').show();

            });

            $('form#viewer input#edit').click(function () {
                $('form#viewer').hide();
                $('form#editor').show();
            });

            $('form#viewer input#show_code').click(function () {
                $('form#viewer fieldset#output').hide();
                $('form#viewer input#show_code').hide();

                var code_fs = $('form#viewer fieldset#code');
                var code = $('<pre></pre>');
                code.text($('form#viewer fieldset#output').html());
                code_fs.html(code).show();

                $('form#viewer input#show_preview').show();
            });

            $('form#viewer input#show_preview').click(function () {
                $('form#viewer fieldset#code').hide();
                $('form#viewer input#show_preview').hide();

                $('form#viewer fieldset#output').show();
                $('form#viewer input#show_code').show();
            });
		});
	</script>
</head>
<body>
<form id="editor">
    <fieldset>
        <legend>Actions</legend>
        <input type="button" id="render" value="Render">
        <input type="button" id="add_stanza" value="Add Stanza (Down)">
        <input type="button" id="add_trans" value="Add Translation (Across)">
    </fieldset>
    <fieldset class="title">
        <legend>Title</legend>
        <div class="edition" edition="0">
            <label for="0-title">Original</label>
            <input type="text" />
        </div>
    </fieldset>
    <fieldset class="stanza" stanza="1">
        <legend>Stanza <span>1</span></legend>
        <div class="edition" edition="0">
            <label for="0-0">Original</label>
            <textarea id="0-0"></textarea>
        </div>
    </fieldset>
</form>
<form id="viewer">
    <fieldset>
        <legend>Actions</legend>
        <input type="button" id="edit" value="Edit" />
        <input type="button" id="show_code" value="Show Code" />
        <input type="button" id="show_preview" value="Show Preview" />
    </fieldset>
    <fieldset id="output">
    </fieldset>
    <fieldset id="code">
        <pre></pre>
    </fieldset id="code">
</form>
</body>
</html>
